{% extends "base.html" %}

{% load django_bootstrap5 %}

{% block title %}
  {{ item_name|capfirst }}s
{% endblock %}

{% block content %}
  <h1 class="my-4">{{ item_name|capfirst }}s</h1>

  {% if active_session_exists %}
    <a href="{% url 'session-finish' %}" class="btn btn-outline-primary">
      Finish current {{ item_name }}
    </a>
  {% else %}
    <form method="post" class="form" action="{% url 'session-start' %}">
      {% csrf_token %}
          <button type="submit" class="btn btn-primary">
            Start new {{ item_name }}
          </button>
    </form>
  {% endif %}

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Code</th>
        <!-- <th>Is active</th> -->
        <th>Started at</th>
        <th>Started by</th>
        <th>Finished at</th>
        <th>Finished by</th>
        <th>Tickets issued</th>
      </tr>
    </thead>

    <tbody>
      {% for object in page_obj %}
        <tr>
          <td class="{% if object.is_active %}bg-primary text-white{% endif %}">{{ object.code }}</td>
          <td class="{% if object.is_active %}bg-primary text-white{% endif %}">{{ object.started_at }}</td>
          <td class="{% if object.is_active %}bg-primary text-white{% endif %}">{{ object.started_by }}</td>
          <td class="{% if object.is_active %}bg-primary text-white{% endif %}">
            {% if object.is_active %}
              = CURRENT SESSION =
            {% else %}
              {{ object.finished_at }}
            {% endif %}
          </td>
          <td class="{% if object.is_active %}bg-primary text-white{% endif %}">
            {% if object.finished_by %}
              {{ object.finished_by }}
            {% endif %}
          </td>
          <td class="{% if object.is_active %}bg-primary text-white{% endif %}">{{ object.tickets_issued }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  
  <div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; first</a>
            <a href="?page={{ page_obj.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
    </span>
  </div>
{% endblock %}
